<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiJu - Partidas</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div class="page-container">
        <header class="page-header">
            <h1>Tablero de Partidas</h1>
            <a href="index.html" class="back-link">‚Äπ Volver al Men√∫</a>
        </header>

        <main class="content-wrapper">
            <!-- Bot√≥n para mostrar formulario de nueva partida -->
            <button id="btn-show-create" class="btn action-btn">+ NUEVA PARTIDA</button>

            <!-- Formulario de creaci√≥n (Inicialmente oculto) -->
            <div id="create-game-container" class="form-container hidden">
                <h2>Configurar Nueva Partida</h2>
                <form id="create-game-form">
                    <input type="hidden" id="edit-game-id">
                    
                    <div class="form-group">
                        <label style="color: #00ffff; font-size: 0.9rem;">Nombre de la Partida</label>
                        <input type="text" id="game-ref" placeholder="Ej: Torneo Viernes Noche" required autocomplete="off" style="font-size: 1.2rem; font-weight: bold;">
                    </div>

                    <div class="form-section-title">‚öôÔ∏è Configuraci√≥n B√°sica</div>
                    
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <div style="flex: 1;">
                            <label for="game-time" style="display: block; color: #aaa; margin-bottom: 5px; font-size: 0.8rem;">TIEMPO / PREGUNTA</label>
                            <input type="number" id="game-time" value="10" min="5" style="width: 100%;">
                        </div>
                        <div style="flex: 1;">
                            <label for="game-questions-qty" style="display: block; color: #aaa; margin-bottom: 5px; font-size: 0.8rem;">N¬∫ PREGUNTAS</label>
                            <input type="number" id="game-questions-qty" value="10" min="1" style="width: 100%;">
                        </div>
                    </div>

                    <div class="form-section-title">üéÆ Reglas de Juego</div>

                    <div class="toggle-row">
                        <label for="game-player-questions" style="cursor: pointer; flex: 1;">¬øJugadores a√±aden pregunta?</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="game-player-questions">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="toggle-row">
                        <label for="game-subtract-errors" style="cursor: pointer; flex: 1;">¬øErrores restan puntos?</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="game-subtract-errors">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="info-box">
                        ‚ÑπÔ∏è <strong>Puntuaci√≥n:</strong> Acierto = +1 punto. <br>
                        Si activas "Errores restan", el fallo ser√° <strong>-1 punto</strong>.
                    </div>

                    <div class="toggle-row" style="border-color: #ffd700;">
                        <label for="game-long-match" style="cursor: pointer; flex: 1; color: #ffd700;">üèÜ Partida Larga (Marat√≥n)</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="game-long-match">
                            <span class="slider" style="background-color: #554400;"></span>
                        </label>
                    </div>
                    <p style="font-size: 0.8rem; color: #666; margin-top: -5px; margin-bottom: 15px; padding-left: 15px;">
                        Requiere +50 preguntas. Permite 3 pausas durante el juego.
                    </p>

                    <div class="form-group">
                        <textarea id="game-obs" placeholder="Observaciones (Opcional)" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn">Crear Partida</button>
                        <button type="button" id="btn-cancel-create" class="btn btn-secondary">Cancelar</button>
                    </div>
                </form>
            </div>

            <!-- Lista de Partidas -->
            <div class="list-container">
                <h2>√öltimas 10 Partidas</h2>
                <div id="games-list" class="games-grid">
                    <p class="loading-text">Cargando partidas...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de Detalles (Ventana emergente) -->
    <div id="game-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-header-row">
                <h2 id="modal-ref">Referencia</h2>
                <button id="btn-modal-play" class="btn-icon-medium" style="border-color: #00ff00; color: #00ff00;" title="Entrar a la Partida">‚ñ∂Ô∏è</button>
                <button id="btn-header-qr" class="btn-icon-medium" title="Ver QR de invitaci√≥n">üì±</button>
                <button id="btn-modal-delete-game" class="btn-icon-medium" style="border-color: #ff4444; color: #ff4444;" title="Eliminar Partida">üóëÔ∏è</button>
            </div>
            <div class="modal-meta">
                <span id="modal-date" class="date-text">Fecha</span>
            </div>
            
            <!-- Panel de Estad√≠sticas (Nuevo) -->
            <div class="modal-stats-grid">
                <div class="stat-box">
                    <span class="stat-label">Estado</span>
                    <span id="modal-status" class="stat-value">--</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">‚è±Ô∏è Tiempo/Preg</span>
                    <span id="modal-time" class="stat-value">--</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Preguntas</span>
                    <span id="modal-questions-qty" class="stat-value">--</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Pregunta/Jugador</span>
                    <span id="modal-player-q-rule" class="stat-value">--</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Errores Restan</span>
                    <span id="modal-subtract-rule" class="stat-value">--</span>
                </div>
                <div class="stat-box hidden" id="modal-pauses-box">
                    <span class="stat-label">Pausas Rest.</span>
                    <span id="modal-pauses-qty" class="stat-value">--</span>
                </div>
            </div>

            <div class="modal-section">
                <h3>Observaciones</h3>
                <p id="modal-obs">Sin observaciones.</p>
            </div>

            <hr class="modal-separator">

            <div class="modal-section">
                <div class="modal-section-header">
                    <h3>Jugadores Apuntados (<span id="modal-players-count">0</span>)</h3>
                    <div class="modal-actions">
                        <button id="btn-modal-add" class="btn-icon-small" title="A√±adir Jugador">+</button>
                    </div>
                </div>
                <!-- Selector de jugadores (Oculto por defecto) -->
                <div id="add-player-select-container" class="hidden" style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <select id="modal-player-select" style="flex-grow: 1; padding: 5px; background: #1a1a2e; color: white; border: 1px solid #333; border-radius: 5px;"></select>
                    <button id="btn-cancel-add" class="btn-icon-small" style="width: auto; padding: 0 10px; border-radius: 5px; background: #555; color: #ccc;">X</button>
                </div>
                <ul id="modal-players-list"></ul>
            </div>
            
            <!-- Bot√≥n Resultados (Solo visible si Cerrada) -->
            <button id="btn-view-results" class="btn action-btn hidden" style="margin-top: 1rem; background: linear-gradient(90deg, #ffd700, #ffaa00); color: #000;">üìä Ver Resultados Detallados</button>

            <!-- Contenedor QR (Oculto por defecto) -->
            <div id="qr-display" class="hidden" style="text-align: center; margin-bottom: 1.5rem; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px;">
                <img id="qr-image" src="" alt="C√≥digo QR" style="border: 5px solid white; border-radius: 10px; max-width: 200px;">
                <p style="margin-top: 10px; color: #00ffff; word-break: break-all; font-size: 0.9rem;" id="game-link-text"></p>
                <button id="btn-send-invite" class="btn action-btn" style="margin-top: 15px; width: auto; font-size: 1rem; padding: 10px 20px;">üìß Enviar invitaci√≥n</button>
            </div>
        </div>
    </div>

    <!-- Modal Tabla de Resultados -->
    <div id="results-table-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 95%; width: 1200px; max-height: 90vh; overflow-y: auto;">
            <span class="close-modal" id="close-results-modal">&times;</span>
            <h2 style="color: #ffd700; text-align: center; margin-bottom: 20px;">Resultados Detallados</h2>
            <div style="overflow-x: auto;">
                <table id="results-table" style="width: 100%; border-collapse: collapse; color: white; min-width: 600px;">
                    <!-- Se llena din√°micamente -->
                </table>
            </div>
        </div>
    </div>

    <!-- SDK de Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-firestore-compat.js"></script>

    <!-- L√≥gica de Partidas -->
    <script src="js/partidas.js"></script>

</body>
</html>